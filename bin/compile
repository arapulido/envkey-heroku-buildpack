#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Attempting to load, decrypt, and export EnvKey variables"

BP_DIR=$(cd $(dirname ${0:-}); cd ..; pwd)
ENV_DIR=$1

echo "ENV_DIR:"
echo $ENV_DIR

echo "ENV_DIR contents:"
echo $(ls $ENV_DIR)

if [ -f $ENV_DIR/ENVKEY ]; then
  echo "ENVKEY config var is set" | indent
  export "ENVKEY=$(cat $ENV_DIR/ENVKEY)"
  short="${ENVKEY:0:3}" ; echo "ENVKEY=${short}..."
  eval $($BP_DIR/ext/envkey-source_1.1.0_linux_amd64/envkey-source)
  echo "ENVKEY variables exported" | indent
else
  echo "ENVKEY config var not set" | indent
fi
